name: Sync Upstream (safe fast-forward)

on:
  schedule:
    - cron: '0 10 * * *' # Daily at 10 AM UTC
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest

    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Sync from upstream
        uses: aormsby/Fork-Sync-With-Upstream-action@v3
        with:
          upstream_repo: 'JakeWharton/plex-auto-trash'
          upstream_branch: 'trunk'
          target_branch: 'master'
          github_token: ${{ secrets.GITHUB_TOKEN }}

          # Optional but recommended:
          force_sync: false        # ensures safe fast-forward only
          tags: false              # do not import or sync tags/releases
          shallow_clone: true      # faster, uses shallow fetch

      - name: Notify if sync failed
        if: failure()
        run: |
          echo "⚠️ Upstream sync failed for thatbritguy/plex-auto-trash"
          echo "You’ll get a GitHub notification with full logs."
          
      - name: Fail workflow explicitly on error
        if: failure()
        run: exit 1

